---
name: write-plan
description: 구조화된 계획 문서 작성 - Context, Goals, Approach, Steps, Risks
user-invocable: true
allowed-tools: Read, Write, Grep, Glob
argument-hint: "[plan-topic]"
---

# 구조화된 계획 문서 작성

체계적이고 실행 가능한 계획 문서를 작성하는 워크플로우입니다.

## 계획 문서 구조 (6 Sections)

### 1️⃣ Context (배경)

**목표**: 왜 이 작업이 필요한지 설명

**포함 내용**:
- 현재 상황
- 문제점 또는 기회
- 이 작업의 배경
- 비즈니스 / 기술적 동기

**템플릿**:
```markdown
## Context

### 현재 상황
현재 우리 시스템은 [...] 상태입니다.

### 문제점
- 문제 1: [...]
- 문제 2: [...]

### 왜 지금인가?
[...]

### 배경 정보
- 관련 프로젝트: [...]
- 이전 시도: [...]
- 참고 자료: [...]
```

**예시**:
```markdown
## Context

### 현재 상황
현재 사용자 인증 시스템은 세션 기반으로 구현되어 있습니다.
모바일 앱과 웹 간 인증 상태 공유가 어렵고, 서버 확장 시 세션 동기화 문제가 발생합니다.

### 문제점
- 수평 확장 시 세션 스토어 부하 증가
- 모바일 앱에서 세션 쿠키 사용 불가
- 마이크로서비스 간 인증 공유 어려움

### 왜 지금인가?
월 활성 사용자가 10만 명을 넘어서면서 서버 확장이 시급해졌습니다.
모바일 앱 출시를 3개월 앞두고 있습니다.
```

---

### 2️⃣ Goals (목표)

**목표**: 구체적이고 측정 가능한 목표 정의

**SMART 기준**:
- **S**pecific: 구체적
- **M**easurable: 측정 가능
- **A**chievable: 달성 가능
- **R**elevant: 관련성 있음
- **T**ime-bound: 기한 명확

**템플릿**:
```markdown
## Goals

### 주요 목표
이 프로젝트는 [핵심 목표]를 달성하는 것입니다.

### 구체적 목표
1. **목표 1**: [측정 가능한 지표]
   - KPI: [...]
   - 목표치: [...]

2. **목표 2**: [...]

### 성공 기준
- [ ] 기준 1: [...]
- [ ] 기준 2: [...]

### 범위 (Scope)

#### In Scope (포함)
- [ ] 기능 A
- [ ] 기능 B

#### Out of Scope (제외)
- ❌ 기능 X: [나중에 고려]
- ❌ 기능 Y: [범위 밖]
```

**예시**:
```markdown
## Goals

### 주요 목표
세션 기반 인증을 JWT 기반 인증으로 전환하여 확장성과 모바일 지원을 개선합니다.

### 구체적 목표
1. **확장성**: 서버 인스턴스 3배 확장 시 응답 시간 10% 이내 증가
2. **보안**: OWASP Top 10 보안 요구사항 충족
3. **모바일 지원**: iOS/Android 앱에서 인증 구현

### 성공 기준
- [ ] 모든 기존 API 엔드포인트가 JWT 지원
- [ ] 토큰 갱신 메커니즘 구현
- [ ] 보안 감사 통과
- [ ] 모바일 앱 개발팀 승인

### 범위

#### In Scope
- [ ] JWT 발급/검증 시스템
- [ ] 리프레시 토큰 구현
- [ ] 기존 API 마이그레이션

#### Out of Scope
- ❌ OAuth 2.0 소셜 로그인 (2단계 프로젝트)
- ❌ 2단계 인증 (나중에 추가)
```

---

### 3️⃣ Approach (접근 방법)

**목표**: 어떻게 문제를 해결할 것인지 전략 설명

**포함 내용**:
- 전체 전략
- 기술 스택 / 도구 선택
- 설계 패턴
- 아키텍처 개요

**템플릿**:
```markdown
## Approach

### 전체 전략
[...]

### 기술 스택
- **언어**: [...]
- **프레임워크**: [...]
- **라이브러리**: [...]
- **인프라**: [...]

### 설계 원칙
1. [원칙 1]
2. [원칙 2]

### 아키텍처 개요
```
[다이어그램 또는 설명]
```

### 기술 결정 및 근거

#### 결정 1: [제목]
- **선택**: [...]
- **대안**: [...]
- **이유**: [...]
- **트레이드오프**: [...]
```

**예시**:
```markdown
## Approach

### 전체 전략
점진적 마이그레이션 방식을 사용합니다.
세션과 JWT를 동시에 지원하는 하이브리드 기간을 두어 리스크를 최소화합니다.

### 기술 스택
- **언어**: Node.js (기존 스택 유지)
- **라이브러리**: jsonwebtoken, bcrypt
- **저장소**: Redis (블랙리스트용)
- **인프라**: 변경 없음

### 설계 원칙
1. 후방 호환성: 기존 세션 사용자 영향 최소화
2. 보안 우선: OWASP 가이드라인 준수
3. 점진적 전환: 단계별 롤아웃

### 아키텍처 개요
```
Client → API Gateway → Auth Middleware → API
                           ↓
                      JWT Validator
                           ↓
                    Redis Blacklist
```

### 기술 결정

#### JWT vs OAuth 2.0
- **선택**: JWT (HS256)
- **대안**: OAuth 2.0
- **이유**:
  - 단순성: 팀 학습 곡선 낮음
  - 자체 운영: 외부 서비스 의존성 없음
  - 충분: 현재 요구사항 만족
- **트레이드오프**: 나중에 소셜 로그인 추가 시 OAuth 도입 필요
```

---

### 4️⃣ Implementation Steps (구현 단계)

**목표**: 실행 가능한 단계별 작업 분해

**원칙**:
- 작은 단위로 분해
- 각 단계는 독립적으로 배포 가능
- 명확한 산출물 정의

**템플릿**:
```markdown
## Implementation Steps

### Phase 1: [제목] (기간: X주)

#### Step 1.1: [작업명]
- **목표**: [...]
- **산출물**: [...]
- **담당**: [팀/개인]
- **예상 시간**: [...]
- **의존성**: [...]
- **검증 방법**: [...]

#### Step 1.2: [작업명]
...

### Phase 2: [제목]
...

### Phase 3: [제목]
...
```

**예시**:
```markdown
## Implementation Steps

### Phase 1: 준비 및 설계 (1주)

#### Step 1.1: JWT 라이브러리 평가 및 선정
- **목표**: 적합한 JWT 라이브러리 선택
- **산출물**: 기술 문서 "JWT 라이브러리 비교"
- **담당**: 백엔드 팀
- **예상 시간**: 2일
- **의존성**: 없음
- **검증 방법**: 팀 리뷰 및 승인

#### Step 1.2: 토큰 스키마 설계
- **목표**: JWT 페이로드 구조 정의
- **산출물**:
  - 토큰 스키마 문서
  - 만료 정책 문서
- **담당**: 백엔드 + 보안 팀
- **예상 시간**: 3일
- **의존성**: Step 1.1
- **검증 방법**: 보안 감사

### Phase 2: 코어 구현 (2주)

#### Step 2.1: JWT 발급/검증 모듈 구현
- **목표**: 핵심 JWT 로직 구현
- **산출물**:
  - `auth/jwt.js` 모듈
  - 단위 테스트 (커버리지 90%+)
- **담당**: 시니어 개발자 A
- **예상 시간**: 1주
- **의존성**: Phase 1 완료
- **검증 방법**: 코드 리뷰 + 테스트 통과

#### Step 2.2: 인증 미들웨어 작성
- **목표**: Express 미들웨어 구현
- **산출물**:
  - `middleware/auth.js`
  - 통합 테스트
- **담당**: 개발자 B
- **예상 시간**: 3일
- **의존성**: Step 2.1
- **검증 방법**: 통합 테스트

#### Step 2.3: 리프레시 토큰 구현
- **목표**: 토큰 갱신 메커니즘
- **산출물**:
  - `/auth/refresh` API
  - Redis 블랙리스트 로직
- **담당**: 개발자 C
- **예상 시간**: 4일
- **의존성**: Step 2.1
- **검증 방법**: E2E 테스트

### Phase 3: 마이그레이션 (3주)

#### Step 3.1: 하이브리드 모드 구현
- **목표**: 세션과 JWT 동시 지원
- **산출물**: 듀얼 인증 미들웨어
- **담당**: 시니어 개발자 A
- **예상 시간**: 1주
- **의존성**: Phase 2 완료
- **검증 방법**: 기존 API 호환성 테스트

#### Step 3.2: API 엔드포인트별 마이그레이션
- **목표**: 각 API를 JWT 기반으로 전환
- **산출물**: 마이그레이션 체크리스트 완료
- **담당**: 전체 백엔드 팀
- **예상 시간**: 2주
- **의존성**: Step 3.1
- **검증 방법**:
  - API별 테스트 통과
  - 카나리 배포

### Phase 4: 완료 및 정리 (1주)

#### Step 4.1: 세션 시스템 제거
- **목표**: 레거시 세션 코드 삭제
- **산출물**: 클린업 커밋
- **담당**: 개발자 A
- **예상 시간**: 2일
- **의존성**: Phase 3 완료, 모든 사용자 마이그레이션 완료
- **검증 방법**: 프로덕션 모니터링

#### Step 4.2: 문서화
- **목표**: API 문서 및 가이드 업데이트
- **산출물**:
  - API 문서
  - 개발자 가이드
  - 운영 가이드
- **담당**: 테크 라이터 + 팀
- **예상 시간**: 3일
- **의존성**: Step 4.1
- **검증 방법**: 문서 리뷰
```

---

### 5️⃣ Risks & Mitigation (리스크 및 완화)

**목표**: 잠재적 리스크 식별 및 대응 방안

**리스크 레벨**:
- 🔴 **High**: 프로젝트 실패 가능
- 🟡 **Medium**: 지연 또는 품질 저하
- 🟢 **Low**: 경미한 영향

**템플릿**:
```markdown
## Risks & Mitigation

### 🔴 High Risk

#### 리스크 1: [제목]
- **설명**: [...]
- **영향**: [...]
- **발생 가능성**: [%]
- **완화 방안**:
  1. [...]
  2. [...]
- **대안 (Plan B)**: [...]

### 🟡 Medium Risk
...

### 🟢 Low Risk
...

### 의존성 리스크
- **외부 의존성**: [...]
- **팀 의존성**: [...]
- **기술 의존성**: [...]
```

**예시**:
```markdown
## Risks & Mitigation

### 🔴 High Risk

#### 리스크 1: 마이그레이션 중 서비스 장애
- **설명**: 세션→JWT 전환 중 인증 실패 발생 가능
- **영향**: 사용자 로그아웃, 서비스 불가
- **발생 가능성**: 30%
- **완화 방안**:
  1. 하이브리드 모드 3주 운영
  2. 카나리 배포 (10% → 50% → 100%)
  3. 즉시 롤백 계획
- **대안 (Plan B)**: 기능 플래그로 즉시 세션으로 복원

#### 리스크 2: 토큰 탈취 시 보안 문제
- **설명**: JWT는 서버에서 무효화 불가
- **영향**: 탈취된 토큰 악용
- **발생 가능성**: 15%
- **완화 방안**:
  1. 짧은 만료 시간 (15분)
  2. 리프레시 토큰 로테이션
  3. 블랙리스트 Redis 운영
  4. 의심 활동 모니터링
- **대안**: 세션 하이브리드 유지

### 🟡 Medium Risk

#### 리스크 3: 모바일 팀 개발 지연
- **설명**: 모바일 앱 개발이 예정보다 늦어짐
- **영향**: JWT 전환 시기 조정 필요
- **발생 가능성**: 40%
- **완화 방안**:
  1. 주간 동기화 미팅
  2. API 먼저 배포, 모바일은 나중에 전환
  3. 하이브리드 모드 연장
- **대안**: 웹만 먼저 JWT 전환

### 🟢 Low Risk

#### 리스크 4: 라이브러리 호환성 문제
- **설명**: jsonwebtoken 라이브러리 버그
- **영향**: 경미한 지연
- **발생 가능성**: 5%
- **완화 방안**:
  1. 검증된 라이브러리 사용
  2. 충분한 테스트
- **대안**: 다른 라이브러리로 전환
```

---

### 6️⃣ Timeline & Milestones (일정 및 마일스톤)

**목표**: 주요 마일스톤과 예상 일정

**템플릿**:
```markdown
## Timeline & Milestones

### 전체 일정
- **시작일**: YYYY-MM-DD
- **종료일**: YYYY-MM-DD
- **총 기간**: X주

### 마일스톤

#### M1: [이름] (Week 1)
- 날짜: YYYY-MM-DD
- 목표: [...]
- 산출물: [...]
- 체크포인트: [...]

#### M2: [이름] (Week 3)
...

### 간트 차트
```
Week 1 2 3 4 5 6 7
Phase 1 █████
Phase 2      ██████████
Phase 3              ████████████
Phase 4                      ████
```

### 체크포인트
- [ ] Week 1: [...]
- [ ] Week 3: [...]
- [ ] Week 6: [...]
```

**예시**:
```markdown
## Timeline & Milestones

### 전체 일정
- **시작일**: 2026-03-01
- **종료일**: 2026-04-30
- **총 기간**: 8주

### 마일스톤

#### M1: 설계 완료 (Week 1)
- 날짜: 2026-03-08
- 목표: 모든 설계 문서 승인
- 산출물:
  - 토큰 스키마
  - 아키텍처 다이어그램
  - 보안 정책
- 체크포인트: 보안 팀 승인

#### M2: 코어 구현 완료 (Week 3)
- 날짜: 2026-03-22
- 목표: JWT 발급/검증 로직 완료
- 산출물:
  - JWT 모듈
  - 단위 테스트 (90%+ 커버리지)
- 체크포인트: 코드 리뷰 통과

#### M3: 하이브리드 배포 (Week 4)
- 날짜: 2026-03-29
- 목표: 프로덕션에 하이브리드 모드 배포
- 산출물:
  - 프로덕션 배포
  - 모니터링 대시보드
- 체크포인트: 장애 없이 1주 운영

#### M4: 완전 전환 (Week 7)
- 날짜: 2026-04-19
- 목표: 모든 사용자 JWT 전환
- 산출물:
  - 세션 시스템 제거
  - 100% JWT 사용
- 체크포인트: 에러율 0.1% 이하

#### M5: 프로젝트 완료 (Week 8)
- 날짜: 2026-04-30
- 목표: 문서화 및 회고
- 산출물:
  - 최종 문서
  - 회고 보고서
- 체크포인트: 프로젝트 종료

### 간트 차트
```
Week    1  2  3  4  5  6  7  8
Phase 1 ██
Phase 2    ████████
Phase 3          ██████████████
Phase 4                      ████
```

### 체크포인트
- [ ] Week 1: 설계 승인 (M1)
- [ ] Week 3: 코어 구현 (M2)
- [ ] Week 4: 하이브리드 배포 (M3)
- [ ] Week 6: 50% 사용자 전환
- [ ] Week 7: 100% 전환 (M4)
- [ ] Week 8: 프로젝트 완료 (M5)
```

---

## 전체 템플릿

```markdown
# 프로젝트 계획: [제목]

작성자: [이름]
날짜: YYYY-MM-DD
버전: 1.0

---

## 1. Context
### 현재 상황
...

### 문제점
...

### 왜 지금인가?
...

---

## 2. Goals
### 주요 목표
...

### 구체적 목표
...

### 성공 기준
...

### 범위
#### In Scope
...

#### Out of Scope
...

---

## 3. Approach
### 전체 전략
...

### 기술 스택
...

### 아키텍처 개요
...

### 기술 결정
...

---

## 4. Implementation Steps
### Phase 1: ...
#### Step 1.1: ...
...

---

## 5. Risks & Mitigation
### 🔴 High Risk
...

### 🟡 Medium Risk
...

### 🟢 Low Risk
...

---

## 6. Timeline & Milestones
### 전체 일정
...

### 마일스톤
...

### 간트 차트
...

---

## 부록
### 참고 자료
- [링크 1]
- [링크 2]

### 의사결정 로그
| 날짜 | 결정 | 이유 |
|------|------|------|
| ... | ... | ... |
```

---

## 베스트 프랙티스

### ✅ 좋은 계획 문서

1. **명확한 목표**: 모호함 없이 구체적
2. **실행 가능**: 실제로 따라 할 수 있는 단계
3. **리스크 고려**: 잠재적 문제 사전 식별
4. **이해관계자 리뷰**: 관련 팀 검토 및 승인
5. **지속적 업데이트**: 계획은 변경될 수 있음

### ❌ 피해야 할 실수

1. **과도한 디테일**: 너무 세부적이면 유지보수 어려움
2. **비현실적 일정**: 버퍼 없는 타이트한 일정
3. **리스크 무시**: "문제 없을 거야"
4. **이해관계자 무시**: 혼자 작성한 계획
5. **문서만 존재**: 계획 없이 실행만

---

## 요약

좋은 계획 문서는:
- ✅ Context부터 Timeline까지 6가지 섹션 포함
- ✅ 구체적이고 측정 가능한 목표
- ✅ 실행 가능한 단계별 작업
- ✅ 리스크와 완화 방안
- ✅ 명확한 마일스톤과 일정

**핵심**: 계획은 지도다. 방향을 잃지 않게 도와준다.
